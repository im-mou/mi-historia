(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{642:function(t,e,n){"use strict";n.r(e);n(14);var o=n(0),a=n.n(o),r=n(9),i=n.n(r),s=n(24),l=n.n(s),u=n(233),c=n(62),d=n(50),h=n(232),p=n.n(h),y=n(142),f=n(143);function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function v(t,e,n){return e&&m(t.prototype,e),n&&m(t,n),t}function S(t,e){return!e||"object"!==b(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function C(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var k=function(t){function e(t){var n,o;return g(this,e),o=""===(n=S(this,E(e).call(this,t))).props.body?d.EditorState.createEmpty():d.EditorState.createWithContent(Object(d.convertFromRaw)(JSON.parse(n.props.body))),n.state={editorState:o,isFocused:!1},n.focus=function(){n.refs.editor.focus(),n.setState({isFocused:!0})},n.blur=function(){n.setState({isFocused:!1})},n.onChange=function(t){n.setState({editorState:t}),n.props.onChange(t)},n.handleKeyCommand=function(t){return n._handleKeyCommand(t)},n.onTab=function(t){return n._onTab(t)},n.toggleBlockType=function(t){return n._toggleBlockType(t)},n.toggleInlineStyle=function(t){return n._toggleInlineStyle(t)},n}return C(e,t),v(e,[{key:"_handleKeyCommand",value:function(t){var e=this.state.editorState,n=d.RichUtils.handleKeyCommand(e,t);return!!n&&(this.onChange(n),!0)}},{key:"_onTab",value:function(t){this.onChange(d.RichUtils.onTab(t,this.state.editorState,4))}},{key:"_toggleBlockType",value:function(t){this.onChange(d.RichUtils.toggleBlockType(this.state.editorState,t))}},{key:"_toggleInlineStyle",value:function(t){this.onChange(d.RichUtils.toggleInlineStyle(this.state.editorState,t))}},{key:"render",value:function(){var t=this.state.editorState,e="RichEditor-editor",n=t.getCurrentContent();return n.hasText()||"unstyled"!==n.getBlockMap().first().getType()&&(e+=" RichEditor-hidePlaceholder"),a.a.createElement("div",{className:"RichEditor-root"},this.state.isFocused?a.a.createElement(P,{editorState:t,onToggle:this.toggleInlineStyle}):"",a.a.createElement("div",{className:e,onBlur:this.blur,onClick:this.focus},a.a.createElement(d.Editor,{blockStyleFn:O,customStyleMap:T,editorState:t,handleKeyCommand:this.handleKeyCommand,onChange:this.onChange,placeholder:this.state.isFocused?"":"Escribe tu historia...",ref:"editor",spellCheck:!0})))}}]),e}(a.a.Component),T={CODE:{backgroundColor:"rgba(0, 0, 0, 0.05)",fontFamily:'"Inconsolata", "Menlo", "Consolas", monospace',fontSize:20,padding:10}};function O(t){switch(t.getType()){case"blockquote":return"RichEditor-blockquote";default:return null}}var j=function(t){function e(){var t;return g(this,e),(t=S(this,E(e).call(this))).onToggle=function(e){e.preventDefault(),t.props.onToggle(t.props.style)},t}return C(e,t),v(e,[{key:"render",value:function(){var t="RichEditor-styleButton";return this.props.active&&(t+=" RichEditor-activeButton"),a.a.createElement("span",{className:t,onMouseDown:this.onToggle},this.props.label)}}]),e}(a.a.Component),R=[{label:"Bold",style:"BOLD"},{label:"Italic",style:"ITALIC"},{label:"Underline",style:"UNDERLINE"}],P=function(t){var e=t.editorState.getCurrentInlineStyle();return a.a.createElement("div",{className:"RichEditor-controls"},R.map((function(n){return a.a.createElement(j,{key:n.label,active:e.has(n.style),label:n.label,onToggle:t.onToggle,style:n.style})})))},F=k;function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function N(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function L(t){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function q(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x(t,e){return(x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var D={items:[{key:"removePost",text:"Eliminar Historia",iconProps:{iconName:"Delete"}}],directionalHintFixed:!0};Object(u.a)();var U=function(t){function e(t){var n,o,a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o=this,(n=!(a=L(e).call(this,t))||"object"!==I(a)&&"function"!=typeof a?q(o):a).handleSave=n.handleSave.bind(q(n)),n.handlePublish=n.handlePublish.bind(q(n)),n.handleRequest=n.handleRequest.bind(q(n)),n.handleInputChange=n.handleInputChange.bind(q(n)),n.toggleSwitch=n.toggleSwitch.bind(q(n)),n.hasErrorFor=n.hasErrorFor.bind(q(n)),n.renderErrorFor=n.renderErrorFor.bind(q(n)),n.handleEditorChange=n.handleEditorChange.bind(q(n)),n.getBodydata=n.getBodydata.bind(q(n)),n.state={uuid:n.props.uuid,title:n.props.title,body:n.props.body,anonymous:n.props.anonymous,published:n.props.published,lastSaved:n.props.lastSaved,lastSavedTime:n.props.lastSavedTime,errors:[],dataLoaded:n.props.dataLoaded},n}var n,o,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}(e,t),n=e,(o=[{key:"componentDidMount",value:function(){var t=this,e="",n="";l.a.get("/api/historia/"+this.state.uuid).then((function(o){null!==o.data.story&&(e=o.data.story.bodyjson),null!==o.data.title&&(n=o.data.title),t.setState({title:n,body:e,anonymous:o.data.anonymous,published:o.data.published,dataLoaded:!0})})).catch((function(e){e.response&&t.setState({errors:e.response.data.errors})}))}},{key:"handleSave",value:function(){this.handleRequest("guardar","Último guardado: ")}},{key:"handlePublish",value:function(){this.handleRequest("publicar")}},{key:"handleRequest",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=this.getBodydata(this.state.body),a={title:this.state.title,body:o.html,bodyjson:o.json,anonymous:this.state.anonymous,published:this.state.published,uuid:this.state.uuid,action:"publicar"===t};l.a.post("/api/historia/"+t,a).then((function(o){e.setState({lastSaved:n,lastSavedTime:new Date(o.data.msg),errors:[],published:"publicar"===t||e.state.published})})).catch((function(t){t.response&&e.setState({errors:t.response.data.errors})}))}},{key:"handleInputChange",value:function(t){var e,n=this.state.errors;n[event.target.name]="",this.setState((B(e={},event.target.name,t.target.value),B(e,"lastSaved","Hay cambios sin guardar"),B(e,"lastSavedTime",null),B(e,"errors",n),e))}},{key:"getBodydata",value:function(t){var e,n=Object(d.convertToRaw)(t.getCurrentContent()),o=JSON.stringify(n);e=JSON.parse(o).blocks.map((function(t){return""===t.text.trim()}));var a=_.uniq(e);return 1===a.length&&a[0]?{html:"",json:""}:{html:p()(n),json:o}}},{key:"handleEditorChange",value:function(t){var e=this.state.errors;e.body="",this.setState({body:t,lastSaved:"Hay cambios sin guardar",lastSavedTime:null,errors:e})}},{key:"toggleSwitch",value:function(t){this.setState({anonymous:!this.state.anonymous})}},{key:"hasErrorFor",value:function(t){return!!this.state.errors[t]}},{key:"renderErrorFor",value:function(t){if(this.hasErrorFor(t))return a.a.createElement(c.a,null,this.state.errors[t][0])}},{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(f.a,{parentState:this.state,menuProps:D,toggleSwitch:this.toggleSwitch,handleSave:this.handleSave,handlePublish:this.handlePublish,successText:y.b.SAVE.SUCCESS}),a.a.createElement("div",{className:"big-input-container"},a.a.createElement("input",{type:"text",className:"form-control big-input",name:"title",autoComplete:"off","aria-describedby":"tituloHelp",placeholder:"Título de tu escrito",onChange:this.handleInputChange,value:this.state.title}),this.renderErrorFor("title")),a.a.createElement(F,{onChange:this.handleEditorChange,body:this.state.body}),this.renderErrorFor("body"))}}])&&N(n.prototype,o),r&&N(n,r),e}(a.a.Component);U.defaultProps={uuid:_.last((new URL(window.location.href)+"").split("/")),title:"",body:"",anonymous:!1,published:!1,lastSaved:"",lastSavedTime:null,dataLoaded:!1},U.propTypes={uuid:i.a.string,title:i.a.string,body:i.a.string,anonymous:i.a.bool,published:i.a.bool,lastSaved:i.a.string,lastSavedTime:i.a.string,dataLoaded:i.a.bool};e.default=U}}]);